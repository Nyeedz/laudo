<div fxLayout="column" fxLayoutAlign="space-around center">
  <div class="card-width">
    <form [formGroup]="form" fxLayout="column">
      <mat-card>
        <mat-card-content fxLayout="column">
          <mat-form-field>
            <mat-label>Tipos de laudo</mat-label>
            <mat-select formControlName="tipos_laudo">
              <mat-option
                *ngFor="let tipo_laudo of tipos_laudo"
                [value]="tipo_laudo.value"
              >
                {{ tipo_laudo.value }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <input
              matInput
              placeholder="Cep"
              formControlName="cep"
              required
              (blur)="consultaCep($event.target.value)"
            />
            <mat-error *ngIf="form?.hasError('required', 'cep')"
              >Cep é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              formControlName="endereco"
              matInput
              placeholder="Endereço"
              required
            />
            <mat-error *ngIf="form?.hasError('required', 'endereco')"
              >Endereço é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              formControlName="bairro"
              matInput
              placeholder="Bairro"
              required
            />
            <mat-error *ngIf="form?.hasError('required', 'bairro')"
              >Bairro é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              formControlName="complemento"
              matInput
              placeholder="Complemento"
            />
          </mat-form-field>

          <mat-form-field>
            <input
              formControlName="cidade"
              matInput
              placeholder="Cidade"
              required
            />
            <mat-error *ngIf="form?.hasError('required', 'cidade')"
              >Cidade é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              formControlName="estado"
              matInput
              placeholder="Estado"
              required
            />
            <mat-error *ngIf="form?.hasError('required', 'estado')"
              >estado é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              formControlName="numero"
              matInput
              placeholder="Número"
              type="number"
              required
            />
            <mat-error *ngIf="form?.hasError('required', 'numero')"
              >Número é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <mat-label>Selecione o usuário responsável pela vistoria</mat-label>
            <mat-select formControlName="user">
              <mat-option *ngFor="let user of users" [value]="user._id">
                {{ user.nome }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="form?.hasError('required', 'user')"
              >Usuário responsável é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field style="width: 360px">
            <input
              matInput
              [matDatepicker]="picker"
              placeholder="Escolha a data para a vistoria"
              formControlName="data"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker touchUi #picker></mat-datepicker>
            <mat-error *ngIf="form?.hasError('required', 'data')"
              >Data para a vistoria é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field style="width: 360px">
            <input
              matInput
              placeholder="Escolha o horário para a vistoria"
              aria-label="Escolha o horário para a vistoria"
              [ngxTimepicker]="darkPicker"
              formControlName="hora"
              readonly
            />
            <ngx-material-timepicker
              #darkPicker
              [ngxMaterialTimepickerTheme]="darkTheme"
            ></ngx-material-timepicker>
            <mat-error *ngIf="form?.hasError('required', 'hora')"
              >Hora para a vistoria é obrigatório</mat-error
            >
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button type="button" (click)="addParte()" mat-button color="primary">
            Adicionar parte
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card
        formArrayName="partes"
        *ngFor="let parte of form.get('partes').controls; let i = index"
      >
        <div class="subcard-header">
          <span>Parte {{ i + 1 }}</span>
          <button type="button" mat-icon-button color="warn">
            <mat-icon (click)="deleteParte(i)">delete</mat-icon>
          </button>
        </div>
        <mat-card-content [formGroupName]="i" fxLayout="column">
          <mat-form-field>
            <input
              matInput
              required
              placeholder="Título"
              formControlName="titulo"
            />
            <mat-error *ngIf="form?.hasError('required', 'titulo')"
              >Título é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              matInput
              placeholder="Nome"
              required
              formControlName="nome_parte"
            />
            <mat-error *ngIf="form?.hasError('required', 'nome_parte')"
              >Nome é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              matInput
              placeholder="E-mail"
              type="email"
              required
              formControlName="email"
            />
            <mat-error *ngIf="form?.hasError('required', 'email')"
              >E-mail é obrigatório</mat-error
            >
          </mat-form-field>

          <mat-form-field>
            <input
              matInput
              placeholder="Telefone"
              required
              formControlName="telefone"
            />
            <mat-error *ngIf="form?.hasError('required', 'telefone')"
              >Telefone é obrigatório</mat-error
            >
          </mat-form-field>
        </mat-card-content>
      </mat-card>
      <button
        mat-raised-button
        color="primary"
        (click)="create()"
        [disabled]="form.invalid"
        style="margin-bottom: 1rem; margin-top: 1rem"
      >
        <mat-icon>
          save
        </mat-icon>
        Solicitar
      </button>
    </form>
  </div>
</div>
