<div class="modal-header">
  <h2 matDialogTitle>Editar Informações</h2>
  <button class="btn-close" mat-icon-button matDialogClose>
    <mat-icon> close </mat-icon>
  </button>
</div>
<mat-dialog-content>
  <file-drop
    dropZoneClassName="image-upload-dropzone"
    contentClassName="image-upload-content"
    (onFileDrop)="dropped($event)"
    (onFileOver)="fileOver($event)"
    (onFileLeave)="fileLeave($event)"
    [showBrowseBtn]="true"
    browseBtnClassName="mat-raised-button mat-primary"
    browseBtnLabel="Enviar arquivo"
    *ngIf="imageBase64 == null"
  >
    <mat-icon>cloud_upload</mat-icon>
  </file-drop>
  <image-cropper
    *ngIf="!cropFinished"
    [imageBase64]="imageBase64"
    [maintainAspectRatio]="true"
    [aspectRatio]="4 / 3"
    [resizeToWidth]="150"
    format="png"
    (imageCropped)="imageCropped($event)"
    (imageLoaded)="imageLoaded()"
    (loadImageFailed)="loadImageFailed()"
  ></image-cropper>
  <div class="preview-actions">
    <img class="avatar-preview" *ngIf="cropFinished" [src]="croppedImage" />
    <button
      *ngIf="!cropFinished && croppedImage !== ''"
      mat-raised-button
      color="primary"
      (click)="confirmImage()"
    >
      Confirmar
    </button>
    <button
      *ngIf="cropFinished"
      mat-raised-button
      color="primary"
      (click)="changeImage()"
    >
      Trocar imagem
    </button>
  </div>
  <form class="form" [formGroup]="form">
    <mat-form-field class="mat-form-field">
      <input formControlName="cnpj" matInput placeholder="Cnpj" required />
      <mat-error *ngIf="form?.hasError('required', 'cnpj')"
        >Cnpj é obrigatório</mat-error
      >
    </mat-form-field>
    <mat-form-field class="mat-form-field">
      <input
        formControlName="nome_fantasia"
        matInput
        placeholder="Nome Fantasia"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'nome_fantasia')"
        >Nome fantasia é obrigatório</mat-error
      >
    </mat-form-field>
    <mat-form-field class="mat-form-field">
      <input
        formControlName="razao_social"
        matInput
        placeholder="Razão Social"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'razao_social')"
        >Razão social é obrigatório</mat-error
      >
    </mat-form-field>

    <mat-form-field>
      <mat-label>Empresas credenciadas</mat-label>
      <mat-select formControlName="empresacredenciadas" multiple>
        <mat-option *ngFor="let empresa of empresasList" [value]="empresa.id">{{
          empresa.razao_social
        }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="mat-form-field">
      <input
        formControlName="email"
        matInput
        placeholder="E-mail"
        required
        type="email"
      />
      <mat-error *ngIf="form?.hasError('required', 'email')"
        >E-mail é obrigatório</mat-error
      >
      <mat-error *ngIf="form?.hasError('email', 'email')"
        >Formato de e-mail inválido</mat-error
      >
    </mat-form-field>
    <mat-form-field class="mat-form-field">
      <input
        formControlName="telefone"
        matInput
        placeholder="Telefone"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'telefone')"
        >Telefone é obrigatório</mat-error
      >
    </mat-form-field>
    <mat-form-field class="mat-form-field">
      <input
        formControlName="inscricao_estadual"
        matInput
        placeholder="Inscrição Estadual"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'inscricao_estadual')"
        >Inscrição estadual é obrigatório</mat-error
      >
    </mat-form-field>
    <mat-form-field class="mat-form-field">
      <input
        formControlName="inscricao_municipal"
        matInput
        placeholder="Inscrição Municipal"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'inscricao_municipal')"
        >Inscrição municipal é obrigatório</mat-error
      >
    </mat-form-field>
    <mat-form-field>
      <input
        matInput
        placeholder="Cep"
        formControlName="cep"
        required
        (blur)="consultaCep($event.target.value)"
      />
      <mat-error *ngIf="form?.hasError('required', 'cep')"
        >Cep é obrigatório</mat-error
      >
    </mat-form-field>

    <mat-form-field>
      <input matInput placeholder="Bairro" formControlName="bairro" required />
      <mat-error *ngIf="form?.hasError('required', 'bairro')"
        >Bairro é obrigatório</mat-error
      >
    </mat-form-field>

    <mat-form-field>
      <input matInput placeholder="Cidade" formControlName="cidade" required />
      <mat-error *ngIf="form?.hasError('required', 'cidade')"
        >Cidade é obrigatório</mat-error
      >
    </mat-form-field>

    <mat-form-field>
      <input matInput placeholder="Estado" formControlName="estado" required />
      <mat-error *ngIf="form?.hasError('required', 'estado')"
        >Estado é obrigatório</mat-error
      >
    </mat-form-field>

    <mat-form-field>
      <input
        matInput
        placeholder="Endereço"
        formControlName="endereco"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'endereco')"
        >Endereço é obrigatório</mat-error
      >
    </mat-form-field>

    <mat-form-field>
      <input
        matInput
        placeholder="Número"
        formControlName="numero"
        type="number"
        required
      />
      <mat-error *ngIf="form?.hasError('required', 'numero')"
        >Número é obrigatório</mat-error
      >
    </mat-form-field>
  </form>
</mat-dialog-content>

<div mat-dialog-actions class="actions">
  <button
    (click)="save()"
    mat-raised-button
    color="primary"
    [disabled]="form.invalid"
  >
    <mat-icon>
      save
    </mat-icon>
    Salvar
  </button>
</div>
